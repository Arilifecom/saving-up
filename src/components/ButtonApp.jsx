import React, { useState } from "react";
import { useAnimate } from "framer-motion";
import { stagger } from "framer-motion/dom";

const randomNumberBetween = (min, max) => {
  return Math.floor(Math.random() * (max - min + 1) + min);
};

function ButtonApp({ handleSubmit }) {
  const [scope, animate] = useAnimate();
  const [buttonText, setButtonText] = useState("計算する");

  const onButtonClick = () => {
    handleSubmit();
    setButtonText("結果を見る ↓");
    const sparkles = Array.from({ length: 7 });
    const sparklesAnimation = sparkles.map((_, index) => [
      `.sparkle-${index}`,
      {
        x: randomNumberBetween(-80, 80),
        y: randomNumberBetween(-80, 80),
        scale: randomNumberBetween(1.5, 2.5),
        opacity: 1,
      },
      {
        duration: 0.4,
        at: "<",
      },
    ]);

    const sparklesFadeOut = sparkles.map((_, index) => [
      `.sparkle-${index}`,
      {
        opacity: 0,
        scale: 0,
      },
      {
        duration: 0.6,
        at: "<",
      },
    ]);

    const sparklesReset = sparkles.map((_, index) => [
      `.sparkle-${index}`,
      {
        x: 0,
        y: 0,
      },
      {
        duration: 0.000001,
      },
    ]);

    animate([
      ...sparklesReset,
      [".letter", { y: -32 }, { duration: 0.2, delay: stagger(0.05) }],
      ["button", { scale: 0.8 }, { duration: 0.1, at: "<" }],
      ["button", { scale: 1 }, { duration: 0.1 }],
      ...sparklesAnimation,
      [".letter", { y: 0 }, { duration: 0.000001 }],
      ...sparklesFadeOut,
    ]);
  };

  return (
    <div className="flex justify-center items-center min-w-[320px] min-h-[120px] mb-16">
      <div ref={scope}>
        <button
          onClick={onButtonClick}
          className="relative rounded-full border-2 border-blue px-6 py-2 text-2xl text-blue transition-colors hover:bg-blue hover:text-light z-100"
        >
          {buttonText}
          <span
            aria-hidden
            className="pointer-events-none absolute inset-0 block -z-100"
          >
            {Array.from({ length: 20 }).map((_, index) => (
              <svg
                className={`absolute left-1/2 top-1/2 opacity-0 sparkle-${index} w-4 h-4 md:w-6 md:h-6`}
                key={index}
                width="48"
                height="52"
                viewBox="0 0 48 52"
                fill="none"
              >
                <path
                  d="M30.8494 9.3843L36.4705 10.876C36.6171 10.906 36.7362 11.0258 36.7699 11.1732L38.2518 16.7943C38.2918 16.9593 38.4368 17.0753 38.6058 17.0753C38.7762 17.0753 38.9198 16.9593 38.9581 16.7943L40.4423 11.1732C40.4738 11.0259 40.5935 10.906 40.7401 10.876L46.3619 9.3843C46.5263 9.3535 46.6429 9.2069 46.6429 9.03798C46.6429 8.86749 46.5263 8.72392 46.3619 8.69097L40.7401 7.20001C40.5935 7.16853 40.4737 7.05029 40.4423 6.90281L38.958 1.2818C38.9197 1.11824 38.7761 1 38.6057 1C38.4366 1 38.2916 1.11824 38.2517 1.2818L36.7698 6.90281C36.7361 7.05019 36.6171 7.16853 36.4704 7.20001L30.8494 8.69097C30.6836 8.72401 30.5684 8.86759 30.5684 9.03798C30.5684 9.2069 30.6836 9.3536 30.8494 9.3843Z"
                  fill="#FFD700"
                  stroke="#4B4B4B"
                />
                <path
                  d="M40.0842 31.9415L37.5328 31.2651C37.466 31.2497 37.4114 31.1975 37.3969 31.13L36.7243 28.5787C36.7067 28.5041 36.6415 28.4512 36.5639 28.4512C36.4878 28.4512 36.4219 28.5042 36.4034 28.5787L35.7309 31.13C35.7155 31.1976 35.6618 31.2497 35.5949 31.2651L33.0443 31.9415C32.969 31.9561 32.916 32.0221 32.916 32.0989C32.916 32.1757 32.969 32.2417 33.0443 32.2571L35.5949 32.9327C35.6618 32.9466 35.7155 33.0018 35.7309 33.0695L36.4034 35.6192C36.4219 35.6938 36.4878 35.7467 36.5639 35.7467C36.6415 35.7467 36.7067 35.6938 36.7243 35.6192L37.3969 33.0695C37.4114 33.0018 37.466 32.9466 37.5328 32.9327L40.0842 32.2571C40.1579 32.2417 40.2117 32.1757 40.2117 32.0989C40.2117 32.0221 40.1579 31.9561 40.0842 31.9415Z"
                  fill="#FFD700"
                  stroke="#4B4B4B"
                />
                <path
                  d="M2.73517 14.6535L6.75148 15.7176C6.85743 15.74 6.94116 15.8253 6.9665 15.9311L8.02448 19.9474C8.05373 20.0664 8.15724 20.1486 8.27791 20.1486C8.39917 20.1486 8.5021 20.0664 8.53057 19.9474L9.58933 15.9311C9.61165 15.8253 9.6984 15.74 9.80357 15.7176L13.8207 14.6535C13.9381 14.629 14.0217 14.523 14.0217 14.4032C14.0217 14.2834 13.9381 14.1806 13.8207 14.156L9.80357 13.0902C9.6984 13.0672 9.61165 12.9844 9.58933 12.8783L8.53057 8.85978C8.5021 8.74301 8.39927 8.66016 8.27791 8.66016C8.15724 8.66016 8.05373 8.74301 8.02448 8.85978L6.9665 12.8784C6.94116 12.9844 6.85743 13.0672 6.75148 13.0903L2.73517 14.1561C2.61537 14.1807 2.5332 14.2835 2.5332 14.4033C2.5332 14.523 2.61537 14.6291 2.73517 14.6535Z"
                  fill="#FFD700"
                  stroke="#4B4B4B"
                />
                <path
                  d="M30.5813 31.8359L26.4521 31.7807L26.3416 30.2304L30.4193 30.2981L30.1783 28.3164L27.2737 28.251L30.0561 23.4447L26.8453 23.3311L24.3945 27.2852L21.9453 23.3311L18.7336 23.4447L21.5161 28.251L18.6115 28.3164L18.3712 30.2981L22.4497 30.2304L22.3376 31.7807L18.2083 31.8359L17.9512 33.952L22.1617 33.9205L21.9261 36.7836H22.2923H24.3093H24.4804H26.4975H26.8645L26.6288 33.9205L30.8393 33.952L30.5813 31.8359Z"
                  fill="#4B4B4B"
                />
                <path
                  d="M46.4102 27.5096C46.0786 26.7095 45.6247 25.9656 45.0773 25.2784C44.5299 24.592 43.8896 23.9609 43.1771 23.3804L43.1334 23.3451L43.1756 23.3804C41.035 21.6406 38.218 20.3108 34.9549 19.3772C31.6887 18.4489 27.9618 17.9307 24 17.9307C20.981 17.9307 18.1003 18.2317 15.4545 18.7852C12.8087 19.3389 10.3978 20.145 8.31862 21.1722L8.31716 21.173C6.24029 22.2034 4.47436 23.458 3.16372 24.9882C2.50958 25.7545 1.96831 26.5952 1.58972 27.5096C1.21045 28.4248 0.999222 29.4114 1 30.4272V38.4076C0.999222 39.4243 1.21035 40.4116 1.58972 41.3268C1.92142 42.1269 2.37516 42.87 2.92257 43.5572C3.47077 44.2444 4.11039 44.8747 4.82292 45.4552L4.82448 45.456C6.965 47.1942 9.78141 48.5271 13.0445 49.4592L13.0515 49.4608L13.2641 49.5206L13.0622 49.463C16.3242 50.3883 20.0443 50.9058 23.9999 50.9066C27.0182 50.9058 29.8996 50.6048 32.5455 50.0513C35.1913 49.4976 37.6022 48.6907 39.6813 47.6641L39.6828 47.6627C41.7597 46.6322 43.5249 45.3769 44.8363 43.8482L44.8371 43.8468C45.4912 43.082 46.0309 42.2422 46.4095 41.3269C46.7881 40.4116 47 39.4243 47 38.4077V30.4273C46.9999 29.4114 46.7888 28.4248 46.4102 27.5096ZM6.14642 42.5637C5.90459 42.3357 5.67884 42.1039 5.47765 41.8696C5.00091 41.3107 4.64308 40.7387 4.40427 40.1629C4.16546 39.5855 4.04567 39.0043 4.04567 38.4077V34.7899C4.51179 35.365 5.06222 35.9078 5.68498 36.4162C5.8347 36.5366 5.98832 36.6558 6.14642 36.774V42.5637ZM10.5566 45.344C10.2534 45.2119 9.95462 45.0767 9.66824 44.934C9.00104 44.6039 8.38676 44.2514 7.82628 43.8837V37.8719C8.66241 38.3518 9.57613 38.7917 10.5566 39.1879V45.344ZM16.018 47.0569C14.6344 46.7643 13.3361 46.3981 12.1391 45.9704H12.2381V39.8012C12.6228 39.9286 13.0174 40.0492 13.4197 40.1644C14.252 40.4009 15.1212 40.6081 16.018 40.7886V47.0569ZM23.1592 47.8515C21.2566 47.8131 19.4277 47.6396 17.6987 47.3601V41.0827C19.4377 41.3515 21.2666 41.5088 23.1592 41.5457V47.8515ZM30.5116 47.3225C28.7211 47.6212 26.8216 47.8085 24.8407 47.8469V41.5494C26.8093 41.511 28.7111 41.3399 30.5116 41.0542V47.3225ZM35.9729 45.932C35.3802 46.1471 34.7629 46.3467 34.1202 46.5294C33.4998 46.706 32.8533 46.8633 32.1916 47.0077V40.7471C33.5222 40.4722 34.7874 40.1298 35.9729 39.7299V45.932ZM40.3839 43.7407C39.5885 44.2859 38.6732 44.7927 37.6529 45.2532V39.1002C38.1442 38.8967 38.621 38.6832 39.0764 38.4583C39.5317 38.2318 39.967 37.9946 40.3839 37.7488V43.7407ZM43.954 38.4076C43.954 39.0042 43.8343 39.5855 43.5948 40.1628C43.2877 40.9091 42.7725 41.6516 42.0637 42.3633V36.6863H41.9639C42.6611 36.1542 43.2791 35.5868 43.7989 34.9795C43.8519 34.9173 43.9026 34.8543 43.954 34.7914V38.4076ZM43.5948 32.1809C43.1801 33.1882 42.3894 34.1879 41.253 35.1131C39.5523 36.5013 37.0855 37.7053 34.1202 38.5474C31.1557 39.392 27.6945 39.8796 23.9999 39.8796C18.3713 39.8819 13.28 38.7433 9.66834 36.952C7.86244 36.0591 6.43124 35.0057 5.47765 33.887C5.00091 33.3289 4.64308 32.7568 4.40427 32.181C4.16546 31.6036 4.04567 31.0231 4.04567 30.4274C4.04567 29.8316 4.16546 29.2512 4.40427 28.6738C4.82048 27.6657 5.60973 26.666 6.74676 25.7423C8.44826 24.3533 10.9143 23.1487 13.8796 22.3065C16.8441 21.4627 20.306 20.9758 23.9998 20.9758C29.6285 20.9727 34.719 22.1122 38.3307 23.9027C40.1373 24.7949 41.5692 25.8498 42.5213 26.967C42.9989 27.5251 43.3566 28.0972 43.5947 28.6737C43.8342 29.2511 43.9539 29.8315 43.9539 30.4273C43.9539 31.023 43.8343 31.6035 43.5948 32.1809Z"
                  fill="#FFD700"
                />
                <path
                  d="M3.16372 24.9882C4.47436 23.458 6.24029 22.2034 8.31716 21.173L8.31862 21.1722C10.3978 20.145 12.8087 19.3389 15.4545 18.7852C18.1003 18.2317 20.981 17.9307 24 17.9307C27.9618 17.9307 31.6887 18.4489 34.9549 19.3772C38.218 20.3108 41.035 21.6406 43.1756 23.3804L43.1334 23.3451L43.1771 23.3804C43.8896 23.9609 44.5299 24.592 45.0773 25.2784C45.6247 25.9656 46.0786 26.7095 46.4102 27.5096C46.7888 28.4248 46.9999 29.4114 47 30.4273V38.4077C47 39.4243 46.7881 40.4116 46.4095 41.3269M3.16372 24.9882L3.18751 24.959M3.16372 24.9882C2.50958 25.7545 1.96831 26.5952 1.58972 27.5096C1.21045 28.4248 0.999222 29.4114 1 30.4272V38.4076C0.999222 39.4243 1.21035 40.4116 1.58972 41.3268C1.92142 42.1269 2.37516 42.87 2.92257 43.5572C3.47077 44.2444 4.11039 44.8747 4.82292 45.4552L4.82448 45.456C6.965 47.1942 9.78141 48.5271 13.0445 49.4592L13.0515 49.4608L13.2641 49.5206L13.0622 49.463C16.3242 50.3883 20.0443 50.9058 23.9999 50.9066C27.0182 50.9058 29.8996 50.6048 32.5455 50.0513C35.1913 49.4976 37.6022 48.6907 39.6813 47.6641L39.6828 47.6627C41.7597 46.6322 43.5249 45.3769 44.8363 43.8482L44.8371 43.8468C45.4912 43.082 46.0309 42.2422 46.4095 41.3269M46.4095 41.3269L46.3857 41.3829M6.14642 42.5637C5.90459 42.3357 5.67884 42.1039 5.47765 41.8696C5.00091 41.3107 4.64308 40.7387 4.40427 40.1629C4.16546 39.5855 4.04567 39.0043 4.04567 38.4077V34.7899C4.51179 35.365 5.06222 35.9078 5.68498 36.4162C5.8347 36.5366 5.98832 36.6558 6.14642 36.774V42.5637ZM10.5566 45.344C10.2534 45.2119 9.95462 45.0767 9.66824 44.934C9.00104 44.6039 8.38676 44.2514 7.82628 43.8837V37.8719C8.66241 38.3518 9.57613 38.7917 10.5566 39.1879V45.344ZM16.018 47.0569C14.6344 46.7643 13.3361 46.3981 12.1391 45.9704H12.2381V39.8012C12.6228 39.9286 13.0174 40.0492 13.4197 40.1644C14.252 40.4009 15.1212 40.6081 16.018 40.7886V47.0569ZM23.1592 47.8515C21.2566 47.8131 19.4277 47.6396 17.6987 47.3601V41.0827C19.4377 41.3515 21.2666 41.5088 23.1592 41.5457V47.8515ZM30.5116 47.3225C28.7211 47.6212 26.8216 47.8085 24.8407 47.8469V41.5494C26.8093 41.511 28.7111 41.3399 30.5116 41.0542V47.3225ZM35.9729 45.932C35.3802 46.1471 34.7629 46.3467 34.1202 46.5294C33.4998 46.706 32.8533 46.8633 32.1916 47.0077V40.7471C33.5222 40.4722 34.7874 40.1298 35.9729 39.7299V45.932ZM40.3839 43.7407C39.5885 44.2859 38.6732 44.7927 37.6529 45.2532V39.1002C38.1442 38.8967 38.621 38.6832 39.0764 38.4583C39.5317 38.2318 39.967 37.9946 40.3839 37.7488V43.7407ZM43.954 38.4076C43.954 39.0042 43.8343 39.5855 43.5948 40.1628C43.2877 40.9091 42.7725 41.6516 42.0637 42.3633V36.6863H41.9639C42.6611 36.1542 43.2791 35.5868 43.7989 34.9795C43.8519 34.9173 43.9026 34.8543 43.954 34.7914V38.4076ZM43.5948 32.1809C43.1801 33.1882 42.3894 34.1879 41.253 35.1131C39.5523 36.5013 37.0855 37.7053 34.1202 38.5474C31.1557 39.392 27.6945 39.8796 23.9999 39.8796C18.3713 39.8819 13.28 38.7433 9.66834 36.952C7.86244 36.0591 6.43124 35.0057 5.47765 33.887C5.00091 33.3289 4.64308 32.7568 4.40427 32.181C4.16546 31.6036 4.04567 31.0231 4.04567 30.4274C4.04567 29.8316 4.16546 29.2512 4.40427 28.6738C4.82048 27.6657 5.60973 26.666 6.74676 25.7423C8.44826 24.3533 10.9143 23.1487 13.8796 22.3065C16.8441 21.4627 20.306 20.9758 23.9998 20.9758C29.6285 20.9727 34.719 22.1122 38.3307 23.9027C40.1373 24.7949 41.5692 25.8498 42.5213 26.967C42.9989 27.5251 43.3566 28.0972 43.5947 28.6737C43.8342 29.2511 43.9539 29.8315 43.9539 30.4273C43.9539 31.023 43.8343 31.6035 43.5948 32.1809Z"
                  stroke="#4B4B4B"
                />
              </svg>
            ))}
          </span>
        </button>
      </div>
    </div>
  );
}
export default ButtonApp;
